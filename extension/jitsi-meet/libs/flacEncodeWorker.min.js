!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/libs/",n(n.s=888)}({119:function(t,e){var n={trace:0,debug:1,info:2,log:3,warn:4,error:5};i.consoleTransport=console;var r=[i.consoleTransport];function o(){var t=arguments[0],e=arguments[1],o=Array.prototype.slice.call(arguments,2);if(!(n[e]<t.level))for(var i=function(){var t={methodName:"",fileLocation:"",line:null,column:null},e=new Error,n=e.stack?e.stack.split("\n"):[];if(!n||n.length<1)return t;var r=null;return n[3]&&(r=n[3].match(/\s*at\s*(.+?)\s*\((\S*)\s*:(\d*)\s*:(\d*)\)/)),!r||r.length<=4?(0===n[2].indexOf("log@")?t.methodName=n[3].substr(0,n[3].indexOf("@")):t.methodName=n[2].substr(0,n[2].indexOf("@")),t):(t.methodName=r[1],t.fileLocation=r[2],t.line=r[3],t.column=r[4],t)}(),s=r.concat(t.transports),a=0;a<s.length;a++){var l=s[a],c=l[e];c&&"function"==typeof c&&c.bind(l,t.id?"["+t.id+"]":"","<"+i.methodName+">: ").apply(l,o)}}function i(t,e,r,i){this.id=e,this.format=i,this.transports=r,this.transports||(this.transports=[]),this.level=n[t];for(var s=Object.keys(n),a=0;a<s.length;a++)this[s[a]]=o.bind(null,this,s[a])}i.addGlobalTransport=function(t){-1===r.indexOf(t)&&r.push(t)},i.removeGlobalTransport=function(t){var e=r.indexOf(t);-1!==e&&r.splice(e,1)},i.prototype.setLevel=function(t){this.level=n[t]},t.exports=i,i.levels={TRACE:"trace",DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},125:function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"c",function(){return o}),n.d(e,"d",function(){return i}),n.d(e,"f",function(){return s}),n.d(e,"e",function(){return a}),n.d(e,"a",function(){return l});var r="MAIN_THREAD_FINISH",o="MAIN_THREAD_INIT",i="MAIN_THREAD_NEW_DATA_ARRIVED",s="WORKER_LIBFLAC_READY",a="WORKER_BLOB_READY",l="DEBUG"},164:function(t,e,n){var r=n(119);function o(t,e){this.logStorage=t,this.stringifyObjects=!(!e||!e.stringifyObjects)&&e.stringifyObjects,this.storeInterval=e&&e.storeInterval?e.storeInterval:3e4,this.maxEntryLength=e&&e.maxEntryLength?e.maxEntryLength:1e4,Object.keys(r.levels).forEach(function(t){this[r.levels[t]]=function(t){this._log.apply(this,arguments)}.bind(this,t)}.bind(this)),this.storeLogsIntervalID=null,this.queue=[],this.totalLen=0,this.outputCache=[]}o.prototype.stringify=function(t){try{return JSON.stringify(t)}catch(t){return"[object with circular refs?]"}},o.prototype.formatLogMessage=function(t){for(var e="",n=1,o=arguments.length;n<o;n++){var i=arguments[n];!this.stringifyObjects&&t!==r.levels.ERROR||"object"!=typeof i||(i=this.stringify(i)),e+=i,n!=o-1&&(e+=" ")}return e.length?e:null},o.prototype._log=function(){var t=this.formatLogMessage.apply(this,arguments);if(t){var e=this.queue.length?this.queue[this.queue.length-1]:void 0;("object"==typeof e?e.text:e)==t?"object"==typeof e?e.count+=1:this.queue[this.queue.length-1]={text:t,count:2}:(this.queue.push(t),this.totalLen+=t.length)}this.totalLen>=this.maxEntryLength&&this._flush(!0,!0)},o.prototype.start=function(){this._reschedulePublishInterval()},o.prototype._reschedulePublishInterval=function(){this.storeLogsIntervalID&&(window.clearTimeout(this.storeLogsIntervalID),this.storeLogsIntervalID=null),this.storeLogsIntervalID=window.setTimeout(this._flush.bind(this,!1,!0),this.storeInterval)},o.prototype.flush=function(){this._flush(!1,!0)},o.prototype._flush=function(t,e){this.totalLen>0&&(this.logStorage.isReady()||t)&&(this.logStorage.isReady()?(this.outputCache.length&&(this.outputCache.forEach(function(t){this.logStorage.storeLogs(t)}.bind(this)),this.outputCache=[]),this.logStorage.storeLogs(this.queue)):this.outputCache.push(this.queue),this.queue=[],this.totalLen=0),e&&this._reschedulePublishInterval()},o.prototype.stop=function(){this._flush(!1,!1)},t.exports=o},27:function(t,e,n){var r=n(119),o=n(164),i={},s=[],a=r.levels.TRACE;t.exports={addGlobalTransport:function(t){r.addGlobalTransport(t)},removeGlobalTransport:function(t){r.removeGlobalTransport(t)},getLogger:function(t,e,n){var o=new r(a,t,e,n);return t?(i[t]=i[t]||[],i[t].push(o)):s.push(o),o},setLogLevelById:function(t,e){for(var n=e?i[e]||[]:s,r=0;r<n.length;r++)n[r].setLevel(t)},setLogLevel:function(t){a=t;for(var e=0;e<s.length;e++)s[e].setLevel(t);for(var n in i){var r=i[n]||[];for(e=0;e<r.length;e++)r[e].setLevel(t)}},levels:r.levels,LogCollector:o}},888:function(t,e,n){"use strict";n.r(e),function(t){var e=n(125);function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=n(27).getLogger(t);self.FLAC_SCRIPT_LOCATION="/libs/",importScripts("/libs/libflac4-1.3.2.min.js");var s={0:"FLAC__STREAM_ENCODER_OK",1:"FLAC__STREAM_ENCODER_UNINITIALIZED",2:"FLAC__STREAM_ENCODER_OGG_ERROR",3:"FLAC__STREAM_ENCODER_VERIFY_DECODER_ERROR",4:"FLAC__STREAM_ENCODER_VERIFY_MISMATCH_IN_AUDIO_DATA",5:"FLAC__STREAM_ENCODER_CLIENT_ERROR",6:"FLAC__STREAM_ENCODER_IO_ERROR",7:"FLAC__STREAM_ENCODER_FRAMING_ERROR",8:"FLAC__STREAM_ENCODER_MEMORY_ALLOCATION_ERROR"},a=Object.freeze({UNINTIALIZED:Symbol("uninitialized"),WORKING:Symbol("working"),FINISHED:Symbol("finished")}),l=5;var c=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4096;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"_encoderId",0),o(this,"_flacBuffers",[]),o(this,"_flacLength",0),o(this,"_state",a.UNINTIALIZED),o(this,"_data",null),o(this,"_onMetadataAvailable",function(){}),!Flac.isReady())throw new Error("libflac is not ready yet!");if(this._sampleRate=e,this._bitDepth=n,this._bufferSize=r,this._encoderId=Flac.init_libflac_encoder(this._sampleRate,1,this._bitDepth,l,0,!0,0),0===this._encoderId)throw new Error("Failed to create libflac encoder.");if(0!==Flac.init_encoder_stream(this._encoderId,this._onEncodedData.bind(this),this._onMetadataAvailable.bind(this)))throw new Error("Failed to initalise libflac encoder.");this._state=a.WORKING}var e,n,c;return e=t,(n=[{key:"encode",value:function(t){if(this._state!==a.WORKING)throw new Error("Encoder is not ready or has finished.");if(!Flac.isReady())throw new Error("Flac not ready");for(var e=t.length,n=new Int32Array(e),r=new DataView(n.buffer),o=0,l=0;l<e;l++)r.setInt32(o,32767*t[l],!0),o+=4;if(1!==Flac.FLAC__stream_encoder_process_interleaved(this._encoderId,n,n.length)){var c=Flac.FLAC__stream_encoder_get_state(this._encoderId);i.error("Error during encoding",s[c])}}},{key:"finish",value:function(){if(this._state===a.WORKING){this._state=a.FINISHED;var t=Flac.FLAC__stream_encoder_finish(this._encoderId);i.log("Flac encoding finished: ",t),Flac.FLAC__stream_encoder_delete(this._encoderId),this._data=this._exportFlacBlob()}}},{key:"getBlob",value:function(){return this._state===a.FINISHED?this._data:null}},{key:"_exportFlacBlob",value:function(){var t=function(t,e){for(var n=new Uint8Array(e),r=0,o=t.length,i=0;i<o;i++){var s=t[i];n.set(s,r),r+=s.length}return n}(this._flacBuffers,this._flacLength);return new Blob([t],{type:"audio/flac"})}},{key:"_onEncodedData",value:function(t,e){this._flacBuffers.push(t),this._flacLength+=t.byteLength}}])&&r(e.prototype,n),c&&r(e,c),t}(),u=null;self.onmessage=function(t){switch(t.data.command){case e.c:var n=t.data.config.bps,r=t.data.config.sampleRate;Flac.isReady()?(u=new c(r,n),self.postMessage({command:e.f})):Flac.onready=function(){setTimeout(function(){u=new c(r,n),self.postMessage({command:e.f})},0)};break;case e.d:null===u?i.error("flacEncoderWorker received data when the encoder isnot ready."):u.encode(t.data.buf);break;case e.b:if(null!==u){u.finish();var o=u.getBlob();self.postMessage({command:e.e,buf:o}),u=null}}}}.call(this,"react/features/local-recording/recording/flac/flacEncodeWorker.js")}});
//# sourceMappingURL=flacEncodeWorker.min.map